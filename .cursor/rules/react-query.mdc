---
description: React-Query íŒŒì¼ ì‘ì„±ì‹œ ì¼ê´€ëœ ê·œì¹™
globs:
  - 'src/**/queries/**/*.ts'
alwaysApply: false
language: ko
intent:
  - 'React-Query íŒŒì¼ ì‘ì„±ì‹œ ì¼ê´€ëœ ê·œì¹™'
---

## ğŸ”‘ 1. QueryKeys í…œí”Œë¦¿

```typescript
// queryKeys.ts
export const queryKeys = {
  [queryKeys.ENTITY, entityId]: '[queryKeys.ENTITY, entityId]',
  [ENTITY_UPPER]_LIST: '[ENTITY_UPPER]_LIST',
} as const;
```

---

## ğŸ“¤ 2. Fetch Query í…œí”Œë¦¿

### 2-1. ë‹¨ì¼ ì—”í‹°í‹° ì¡°íšŒ (with ID)

```typescript
// useFetch[Entity]Query.ts
import { UseQueryOptions, useQuery } from '@tanstack/react-query';

import { [entityApi] } from '../_apis/[entityApi]';
import [EntityResponse] from '../_apis/dto/[EntityResponse]';
import [EntityModel] from '../_models/[EntityModel]';
import { queryKeys } from './queryKeys';

export function useFetch[Entity]Query(
  [entityId]: number,
  queryOptions?: Omit<
    UseQueryOptions<[EntityResponse], Error, [EntityModel]>,
    'queryKey' | 'queryFn'
  >,
) {
  return useQuery({
    queryKey: [queryKeys.[ENTITY_KEY], [entityId]],
    queryFn: () => [entityApi].get[Entity]([entityId]),
    select: (data) => new [EntityModel](data),
    ...queryOptions,
  });
}
```

### 2-2. ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ (with í˜ì´ì§€ë„¤ì´ì…˜/í•„í„°)

```typescript
// useFetch[Entity]sQuery.ts ë˜ëŠ” useFetch[Entity]ListQuery.ts
import { UseQueryOptions, useQuery } from '@tanstack/react-query';
import { PaginatedData } from 'src/types/pagination';

import { [EntityResponse] } from '../_apis/dto/[EntityResponse]';
import { Fetch[Entity]Params, [entityApi] } from '../_apis/[entityApi]';
import [EntityModel] from '../_models/[EntityModel]';
import { queryKeys } from './queryKeys';

export function useFetch[Entity]sQuery(
  params: Fetch[Entity]Params,
  queryOptions?: Omit<
    UseQueryOptions<
      PaginatedData<[EntityResponse]>,
      Error,
      PaginatedData<[EntityModel]>
    >,
    'queryKey' | 'queryFn'
  >,
) {
  return useQuery({
    queryKey: [
      queryKeys.[ENTITY_LIST_KEY],
      params.page,
      params.searchText,
      params.[filterParam],
    ],
    queryFn: async () => await [entityApi].get[Entity]s(params),
    select: (data) => ({
      ...data,
      content: data.content.map((item) => new [EntityModel](item)),
    }),
    ...queryOptions,
  });
}
```

### 2-3. ë‹¨ìˆœ ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ (í˜ì´ì§€ë„¤ì´ì…˜ ì—†ìŒ)

```typescript
// useFetch[Entity]sQuery.ts
import { UseQueryOptions, useQuery } from '@tanstack/react-query';

import { [entityApi] } from '../_apis/[entityApi]';
import [EntityResponse] from '../_apis/dto/[EntityResponse]';
import [EntityModel] from '../_models/[EntityModel]';
import { queryKeys } from './queryKeys';

export function useFetch[Entity]sQuery(
  queryOptions?: Omit<
    UseQueryOptions<[EntityResponse][], Error, [EntityModel][]>,
    'queryKey' | 'queryFn'
  >,
) {
  return useQuery({
    queryKey: [queryKeys.[ENTITY_KEY]],
    queryFn: () => [entityApi].get[Entity]s(),
    select: (data) => data.map((item) => new [EntityModel](item)),
    ...queryOptions,
  });
}
```

---

## âœï¸ 3. Create Mutation í…œí”Œë¦¿

### 3-1. ê°„ë‹¨í•œ Create (Model ì§ì ‘ ì‚¬ìš©)

```typescript
// useCreate[Entity]Mutation.ts
import { UseMutationOptions, useMutation } from '@tanstack/react-query';

import { [entityApi] } from '../_apis/[entityApi]';
import Create[Entity]Request from '../_apis/dto/Create[Entity]Request';
import [EntityModel] from '../_models/[EntityModel]';

export const useCreate[Entity]Mutation = (
  mutationOptions?: Omit<
    UseMutationOptions<{ data: number }, Error, [EntityModel]>,
    'mutationFn'
  >,
) => {
  return useMutation({
    mutationFn: (data: [EntityModel]) => [entityApi].create[Entity](data.toDTO()),
    ...mutationOptions,
  });
};
```

## ğŸ—‘ï¸ 5. Delete Mutation í…œí”Œë¦¿

### 5-1. ë‹¨ìˆœ Delete

```typescript
// useDelete[Entity]Mutation.ts
import { UseMutationOptions, useMutation } from '@tanstack/react-query';

import { [entityApi] } from '../_apis/[entityApi]';

export const useDelete[Entity]Mutation = (
  mutationOptions?: Omit<
    UseMutationOptions<unknown, Error, number>,
    'mutationFn'
  >,
) => {
  return useMutation({
    mutationFn: ([entityId]: number) => [entityApi].delete[Entity]([entityId]),
    ...mutationOptions,
  });
};
```

---

## ğŸš€ 6. ì‚¬ìš© ì˜ˆì‹œ

### Query ì‚¬ìš©

```typescript
// ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©
const { data: customer } = useFetchCustomerQuery(customerId, {
  enabled: !!customerId,
  staleTime: 5 * 60 * 1000, // 5ë¶„
});

const { data: customers } = useFetchCustomersQuery(
  { page: 1, searchText: '', grade: 'VIP' },
  {
    onSuccess: (data) => {
      console.log('ê³ ê° ëª©ë¡ ì¡°íšŒ ì„±ê³µ:', data);
    },
  },
);
```

### Mutation ì‚¬ìš© (ì™¸ë¶€ ì£¼ì… íŒ¨í„´)

```typescript
// ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©
const createCustomerMutation = useCreateCustomerMutation({
  onSuccess: (response) => {
    queryClient.invalidateQueries({
      queryKey: [queryKeys.CUSTOMERS],
    });
    toast.success('ê³ ê°ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
  },
  onError: (error) => {
    console.error('ê³ ê° ë“±ë¡ ì‹¤íŒ¨:', error);
    toast.error('ê³ ê° ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
  },
});

const handleSubmit = (data: CustomerModel) => {
  createCustomerMutation.mutate(data);
};
```

---

## ğŸ“ 7. í•µì‹¬ ë³€ê²½ì‚¬í•­

### QueryKey íŒ¨í„´

- **ë‹¨ì¼ ì¡°íšŒ**: `[queryKeys.ENTITY, entityId]` - IDë¥¼ í¬í•¨í•˜ì—¬ ìºì‹œ êµ¬ë¶„

### íƒ€ì… ì•ˆì „ì„±

- `Omit<UseQueryOptions, 'queryKey' | 'queryFn'>` - í•µì‹¬ í•¨ìˆ˜ëŠ” ì œì™¸í•˜ê³  ì˜µì…˜ë§Œ ì£¼ì…
- `Omit<UseMutationOptions, 'mutationFn'>` - mutationFnì€ ë‚´ë¶€ì—ì„œ ê´€ë¦¬

### DTO â†” Model ë³€í™˜

- **Query**: `select` í•¨ìˆ˜ì—ì„œ Response â†’ Model ë³€í™˜

### ì™¸ë¶€ ì£¼ì… íŒ¨í„´

- `onSuccess`, `onError` ë“±ì€ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì£¼ì…
- Query/Mutation ë¡œì§ê³¼ UI ë¡œì§ ë¶„ë¦¬
- ì¬ì‚¬ìš©ì„±ê³¼ í…ŒìŠ¤íŠ¸ ìš©ì´ì„± í–¥ìƒ
